# 第8章 概率机器人基础

## 8.1 概率机器人的基本概念

### 8.1.1 机器人的不确定性来源

机器人在实际环境中运行时面临多种不确定性：

1. **传感器噪声**：传感器测量存在随机误差
2. **执行器不确定性**：电机、轮子等执行器存在控制误差
3. **环境不确定性**：环境模型不完全或动态变化
4. **模型不确定性**：机器人运动学和动力学模型的近似

**例 8.1（激光雷达测量）** 激光雷达测量距离时，误差通常建模为高斯分布：
$$z = d + \epsilon, \quad \epsilon \sim N(0, \sigma^2)$$

其中 $d$ 是真实距离，$\sigma$ 取决于传感器特性。

### 8.1.2 概率机器人的基本框架

概率机器人使用概率分布表示机器人的状态不确定性，通过贝叶斯推断进行状态估计和决策。

**状态表示**：机器人在时刻 $t$ 的状态 $x_t$ 是一个随机变量，其不确定性用概率分布 $p(x_t)$ 表示。

**基本问题**：
1. **状态估计**：根据历史观测和控制，估计当前状态
2. **预测**：预测未来状态
3. **决策**：在不确定性下做出最优决策

### 8.1.3 状态估计和滤波的必要性

**确定性方法的局限**：
- 无法处理传感器噪声
- 无法量化估计的不确定性
- 在复杂环境中容易失效

**概率方法的优势**：
- 显式建模不确定性
- 提供置信度估计
- 可以融合多源信息
- 支持最优决策

## 8.2 机器人的概率模型

### 8.2.1 运动模型

**定义 8.1（运动模型）** **运动模型**（Motion Model）描述了在给定控制 $u_t$ 下，机器人从状态 $x_{t-1}$ 转移到 $x_t$ 的概率：
$$p(x_t | x_{t-1}, u_t)$$

**例 8.2（速度运动模型）** 对于差分驱动机器人，给定线速度 $v$ 和角速度 $\omega$，运动模型为：
$$\begin{pmatrix} x_t \\ y_t \\ \theta_t \end{pmatrix} = \begin{pmatrix} x_{t-1} \\ y_{t-1} \\ \theta_{t-1} \end{pmatrix} + \begin{pmatrix} -\frac{v}{\omega}\sin\theta_{t-1} + \frac{v}{\omega}\sin(\theta_{t-1} + \omega\Delta t) \\ \frac{v}{\omega}\cos\theta_{t-1} - \frac{v}{\omega}\cos(\theta_{t-1} + \omega\Delta t) \\ \omega\Delta t \end{pmatrix} + \epsilon$$

其中 $\epsilon$ 是过程噪声。

**例 8.3（里程计运动模型）** 基于编码器读数的运动模型：
$$p(x_t | x_{t-1}, u_t) = \mathcal{N}(x_t; f(x_{t-1}, u_t), \Sigma)$$

### 8.2.2 观测模型

**定义 8.2（观测模型）** **观测模型**（Measurement Model）描述了在给定状态 $x_t$ 下，获得观测 $z_t$ 的概率：
$$p(z_t | x_t)$$

**例 8.4（激光雷达观测模型）** 对于已知地图 $m$，激光雷达观测的概率为：
$$p(z_t | x_t, m) = \prod_{k=1}^K p(z_t^k | x_t, m)$$

其中 $z_t^k$ 是第 $k$ 束激光的测量值。

**波束模型**：
$$p(z | x, m) = \begin{cases} z_{\text{hit}} \cdot \mathcal{N}(z; z^*, \sigma^2) & \text{命中} \\ z_{\text{short}} \cdot \eta \lambda e^{-\lambda z} & \text{短读数} \\ z_{\text{max}} & z = z_{\text{max}} \\ z_{\text{rand}} & \text{均匀} \end{cases}$$

### 8.2.3 环境模型的概率表示

**占用栅格地图**：将环境离散化为栅格，每个栅格表示被占用的概率：
$$p(m_i = 1 | z_{1:t}, x_{1:t})$$

**贝叶斯更新**：
$$p(m_i | z_t, x_t) = \frac{p(z_t | m_i, x_t) p(m_i)}{p(z_t | x_t)}$$

**对数几率形式**：
$$l(m_i | z_{1:t}, x_{1:t}) = l(m_i | z_{1:t-1}, x_{1:t-1}) + l(m_i | z_t, x_t) - l(m_i)$$

其中 $l(m) = \log\frac{p(m)}{1-p(m)}$。

## 8.3 贝叶斯滤波的基本框架

### 8.3.1 贝叶斯滤波的递推公式

**定理 8.1（贝叶斯滤波）** 信念（Belief）$\text{bel}(x_t) = p(x_t | z_{1:t}, u_{1:t})$ 的递推更新为：

**预测步**：
$$\overline{\text{bel}}(x_t) = \int p(x_t | x_{t-1}, u_t) \text{bel}(x_{t-1}) dx_{t-1}$$

**更新步**：
$$\text{bel}(x_t) = \eta \cdot p(z_t | x_t) \overline{\text{bel}}(x_t)$$

其中 $\eta$ 是归一化常数。

### 8.3.2 预测和更新步骤

**预测步**（时间更新）：
- 根据运动模型预测状态
- 不确定性增加（预测扩散）

**更新步**（测量更新）：
- 根据观测模型修正预测
- 不确定性减小（信息增益）

### 8.3.3 贝叶斯滤波的收敛性分析

**定理 8.2（滤波收敛性）** 在满足一定条件下（可观测性、噪声有界），贝叶斯滤波器的估计误差协方差收敛到一个稳定值。

**信息论解释**：
- 预测步增加熵（不确定性增加）
- 更新步减少熵（信息增加）
- 稳态时两者平衡

## 8.4 本章小结

本章介绍了概率机器人的基础概念：

1. **不确定性来源**：传感器、执行器、环境、模型
2. **运动模型**：$p(x_t | x_{t-1}, u_t)$ 描述状态转移
3. **观测模型**：$p(z_t | x_t)$ 描述测量过程
4. **贝叶斯滤波**：递推的状态估计算法框架

这些概念是后续学习卡尔曼滤波、粒子滤波等具体算法的基础。

## 8.5 参考文献

1. Thrun, S., Burgard, W., & Fox, D. (2005). *Probabilistic Robotics*. MIT Press.
2. Barfoot, T. D. (2017). *State Estimation for Robotics*. Cambridge University Press.
3. Särkkä, S. (2013). *Bayesian Filtering and Smoothing*. Cambridge University Press.

## 8.6 练习题

1. 解释为什么概率方法比确定性方法更适合处理机器人中的不确定性。

2. 对于差分驱动机器人，推导速度运动模型。

3. 证明占用栅格地图的对数几率更新公式。

4. 推导贝叶斯滤波的递推公式。

5. 解释预测步和更新步对状态估计不确定性的影响。
